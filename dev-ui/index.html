<!DOCTYPE html>
<html>
<head>
<title>Boat Monitor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial,sans-serif;margin:0;padding:10px;max-width:600px;margin:0 auto;}
h1{text-align:center;font-size:1.5em;margin:10px 0;}
.card{border:1px solid #ccc;padding:15px;margin:10px 0;}
.card h2{font-size:1.1em;margin:0 0 10px 0;border-bottom:1px solid #ddd;padding-bottom:5px;}
.row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid #eee;}
.row:last-child{border-bottom:none;}
.label{font-weight:bold;}
.level{font-size:2em;text-align:center;margin:10px 0;}
.thresh{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;}
.thresh div{border:1px solid #ccc;padding:10px;text-align:center;}
.thresh .label{font-size:0.8em;display:block;margin-bottom:5px;}
button{width:100%;padding:12px;margin:5px 0;border:1px solid #333;background:#fff;font-size:1em;cursor:pointer;}
button:active{background:#eee;}
</style>
<script>
function load(){
fetch('/status').then(r=>r.json()).then(d=>{
document.getElementById('wifi_status').textContent=(d.connected?'● '+d.ssid:'○ Disconnected');
document.getElementById('wifi_ip').textContent=d.ip||'N/A';
document.getElementById('wifi_rssi').textContent=(d.rssi||'N/A')+' dBm';
}).catch(e=>console.error(e));
fetch('/read').then(r=>r.json()).then(d=>{
document.getElementById('water_level').textContent=(d.sensorAvailable&&d.valid)?d.level_cm.toFixed(1):'--';
}).catch(e=>console.error(e));
fetch('/emergency-settings').then(r=>r.json()).then(d=>{
document.getElementById('tier1').value=d.emergencyWaterLevel_cm.toFixed(1);
document.getElementById('tier2').value=d.urgentEmergencyWaterLevel_cm.toFixed(1);
}).catch(e=>console.error(e));
}

window.onload=load;
function updateThresholds(){
var tier1=parseFloat(document.getElementById('tier1').value);
var tier2=parseFloat(document.getElementById('tier2').value);
var status=document.getElementById('threshold-status');
if(isNaN(tier1)||isNaN(tier2)){status.textContent='⚠️ Please enter valid numbers';status.style.color='red';return;}
if(tier1>=tier2){status.textContent='⚠️ Tier 1 must be less than Tier 2';status.style.color='red';return;}
if(tier1<5||tier1>100||tier2<5||tier2>100){status.textContent='⚠️ Values must be between 5 and 100 cm';status.style.color='red';return;}
status.textContent='⏳ Updating...';status.style.color='#666';
Promise.all([
fetch('/calibration/emergency-level',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'level_cm='+tier1}),
fetch('/emergency/urgent-level',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'level_cm='+tier2})
]).then(responses=>Promise.all(responses.map(r=>r.json()))).then(results=>{
if(results[0].success&&results[1].success){
status.textContent='✓ Thresholds updated successfully';status.style.color='green';
setTimeout(()=>{status.textContent='';},3000);
}else{
status.textContent='⚠️ Update failed: '+(results[0].error||results[1].error||'Unknown error');status.style.color='red';
}
}).catch(e=>{status.textContent='⚠️ Error: '+e.message;status.style.color='red';console.error(e);});
}
</script>
</head>
<body>
<h1>Bilge Buddy</h1>

<div class="card">
<h2>WiFi Connection</h2>
<div class="row"><span class="label">Status</span><span id="wifi_status">Loading...</span></div>
<div class="row"><span class="label">IP Address</span><span id="wifi_ip">Loading...</span></div>
<div class="row"><span class="label">Signal</span><span id="wifi_rssi">Loading...</span></div>
</div>

<div class="card">
<h2>Current Water Level</h2>
<div class="level"><span id="water_level">--</span> cm</div>
</div>

<div class="card">
<h2>Emergency Thresholds</h2>
<div class="thresh">
<div><span class="label">TIER 1</span><input type="number" id="tier1" step="0.1" min="5" max="100" style="width:100%;padding:5px;margin-top:5px;box-sizing:border-box;"> cm</div>
<div><span class="label">TIER 2</span><input type="number" id="tier2" step="0.1" min="5" max="100" style="width:100%;padding:5px;margin-top:5px;box-sizing:border-box;"> cm</div>
</div>
<button onclick="updateThresholds()" style="margin-top:10px;">Update Thresholds</button>
<div id="threshold-status" style="text-align:center;margin-top:10px;font-size:0.9em;"></div>
</div>

<button onclick="location.href='notifications.html'">Notification Settings</button>
<button onclick="location.href='wifi-config.html'">WiFi Networks</button>
<button onclick="location.href='debug.html'">Advanced Debug & Calibration</button>


</body>
</html>
